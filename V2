<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>NTUH CVS è¡€ç®¡é€šè·¯ ç…§æœƒè¡¨å–®</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 16px; margin: 40px; background-color: #f7f9fc; }
    h1 { color: #0d47a1; margin-bottom: 20px; }
    form { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    label { font-weight: bold; margin-top: 15px; display: block; }
    input[type=text], select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    input[type=text].small-input {
      width: 150px;
      display: inline-block;
      margin-left: 10px;
    }
    .small-note {
      font-size: 0.85em;
      color: gray;
      margin-top: 5px;
      margin-bottom: 20px;
      line-height: 1.4;
    }
    .sub-item {
      margin-left: 20px;
      font-size: 1em;
      font-weight: normal;
    }
    button {
      background-color: #1976d2;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      margin-right: 10px;
    }
    button:hover {
      background-color: #0d47a1;
    }
    #result {
      background-color: #f1f1f1;
      padding: 20px;
      margin-top: 30px;
      border-radius: 10px;
      white-space: pre-line;
      font-size: 1em;
      line-height: 1.5;
    }
    #copyButton {
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>NTUH CVS è¡€ç®¡é€šè·¯ ç…§æœƒè¡¨å–®</h1>

<div class="small-note">
  - æ­¤è¡¨å–®ã€Œåƒ…ã€é©ç”¨æ–¼ã€Œè¡€ç®¡æ¤å…¥é€šè·¯ã€ç…§æœƒ (Permcath, Port-A, PICC...)<br>
  - ã€Œä¸ã€åŒ…å« Aorta Disease, PAOD, Venous Disease...<br>
  - è‹¥éœ€åŒæ™‚é€²è¡Œã€Œæ´—è… AVF/AVGã€ç…§æœƒï¼Œè«‹ç›´æ¥å…ˆè¡Œé›»è©±è¯çµ¡ç•¶æœˆã€Œè¡€ç®¡ã€ç…§æœƒ<br>
  - è«‹å°‡è¡¨å–®å®Œæˆå¾Œï¼Œâ€œCOPY & PASTEâ€ è‡³ç…§æœƒå–®ä¸­<br>
  - è‹¥ç…§æœƒå…§å®¹å‡ã€Œç„¡éœ€è¨è«–é …ç›®ã€å¯ã€Œç›´æ¥ã€ç™¼ç…§æœƒå–®ï¼Œä¸å¿…å…ˆè¡Œé›»è©±è¯çµ¡<br>
  - è«‹ã€Œåªã€æ–¼ 8:00 am - 17:00 pm æ™‚æ®µç™¼æ­¤é¡ç…§æœƒ<br>
  - ç—…äººç”Ÿå‘½å¾µè±¡è‹¥åœ¨ç…§æœƒä¹‹å¾Œæœ‰è®ŠåŒ–ï¼Œè«‹ã€Œå‹™å¿…è¯çµ¡ã€å·²é‡æ–°è©•ä¼°æ‰‹è¡“æ˜¯å¦å¯è¡Œ<br>
  - è‹¥æœ‰ä»»ä½•å…¶ä»–å•é¡Œå¯è¯çµ¡ç•¶æœˆã€Œè¡€ç®¡ã€ç…§æœƒï¼Œè¬è¬ï¼
</div>
<br>
<form id="myForm">
  <label>ç…§æœƒéœ€æ±‚ï¼ˆå¿…é¸ï¼‰ï¼š</label>
  <select name="requestType" id="requestType" required>
    <option value="">è«‹é¸æ“‡</option>
    <option value="Permcath insertion">Permcath insertion</option>
    <option value="Permcath/Port-A removal/exchange">Permcath/Port-A removal/exchange</option>
    <option value="PICC insertion">PICC insertion</option>
    <option value="Port-A insertion">Port-A insertion</option>
  </select>

  <div id="extraQuestions"></div>

  <label>è‹¥æœ‰æ´—è…HDï¼Œè«‹å¡«æ´—è…æ’ç­ï¼Œä»¥åˆ©æ‰‹è¡“æ’ç¨‹ï¼ˆè‹¥ç„¡å¯ç•™ç©ºï¼Œä¾‹å¦‚ï¼šHD QW135ï¼‰ï¼š</label>
  <input type="text" name="hdSchedule">

  <label>æ˜¯å¦éš”é›¢ï¼Ÿ</label>
  <select name="isIsolation" id="isIsolation" required>
    <option value="No">å¦</option>
    <option value="Yes">æ˜¯ï¼ˆè«‹å¡«å¯«éš”é›¢é …ç›®ï¼‰</option>
  </select>

  <div id="isolationItemDiv" style="display:none;">
    <label class="sub-item">éš”é›¢é …ç›®ï¼š</label>
    <input type="text" name="isolationItem">
  </div>

  <hr>

  <h2 style="margin-top: 30px; font-size: 1.4em; color: #0d47a1;">ç—…äººåŸºæœ¬è³‡æ–™èˆ‡ç‹€æ³</h2>
  <div class="small-note">
    è‹¥ç—…äººä»¥ä¸‹ç‹€æ³æœ‰ã€Œéœ€è¨è«–é …ç›®ã€ï¼Œè«‹ç›´æ¥ã€Œé›»è©±ã€è¯çµ¡å…ˆè¡Œè¨è«–ï¼Œå‹¿ç›´æ¥ç™¼ç…§æœƒï¼
  </div>

  <label>Age & Sexï¼š</label>
  <input type="text" name="ageSex" required>

  <label>Active problem / Underlying diseasesï¼š</label>
  <textarea name="diseases" rows="3" cols="40" required></textarea>

  <label>Hemodynamic statusï¼š</label>
  <select name="hemodynamic" required>
    <option value="Stable">Stable</option>
    <option value="Unstable">Unstable</option>
  </select>
  <div class="small-note">
    "Unstable" â” Must contact us for discussion !!!<br>
    åŒ…å«ï¼šä½¿ç”¨ Inotropic/Vasopressors æˆ–æœ€è¿‘3å¤©æœ‰ MAP &lt;65 çš„ä½è¡€å£“ç™¼ä½œ
  </div>

  <label>O2 Demandï¼š</label>
  <select name="o2Demand" id="o2Demand" required>
    <option value="No O2 demand">No O2 demand</option>
    <option value="Need O2 supply">Need O2 supply</option>
  </select>
  <div id="o2ExtraQuestions" class="sub-item"></div>
  <div class="small-note">
    è‹¥æœ‰ O2 Supply â” Must contact us for discussion !!!<br>
    ä¸¦è¨»æ˜ä½¿ç”¨è£ç½®ï¼ˆMaskã€NRMã€BIPAPã€HFNCã€Ventilatorã€Collarï¼‰åŠ FiO2
  </div>

  <label>Consciousness Statusï¼š</label>
  <select name="consciousness" required>
    <option value="Clear & Alert">Clear & Alert</option>
    <option value="Delirium/Drowsy/Sedated">Delirium/Drowsy/Sedated</option>
  </select>
  <div class="small-note">
    Delirium / Dementia / Drowsy / Sedated â” Must contact us for discussion !!!
  </div>

  <label>èƒ½å¦å¹³èººè‡³å°‘30åˆ†é˜ä¸”é…åˆæŒ‡ä»¤ï¼Ÿ</label>
  <select name="canLieFlat" required>
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>
  <div class="small-note">
    å¿…é ˆèƒ½ã€Œå¹³èººè‡³å°‘30åˆ†é˜ã€ï¼Œä¸¦é…åˆå±€éº»æ‰‹è¡“æŒ‡ä»¤<br>
    è‹¥ç„¡æ³•é…åˆ â” Must contact us for discussion !!!
  </div>

  <label>æ˜¯å¦ç°½ç½²DNRï¼Ÿ</label>
  <select name="dnr" id="dnr" required>
    <option value="No">No</option>
    <option value="Yes">Yes</option>
  </select>
  <div id="dnrExtraQuestions" class="sub-item"></div>

  <label>Any catheters/lines implanted at neck/chestï¼Ÿ</label>
  <select name="catheters" id="catheters" required>
    <option value="No">No</option>
    <option value="Yes">Yes</option>
  </select>

  <div id="cathetersArea" class="sub-item" style="margin-top: 10px; display:none;">
    <div style="font-weight:bold; margin-bottom:5px;">è«‹é¸æ“‡å·²æ¤å…¥ä¹‹Catheter/Lineç¨®é¡åŠä½ç½®</div>
    <label><input type="checkbox" name="catheterTypes" value="CVC"> CVC</label>
    <input type="text" name="location_CVC" class="small-input" placeholder="Location" style="display:none;">
    <br>
    <label><input type="checkbox" name="catheterTypes" value="DLC"> DLC</label>
    <input type="text" name="location_DLC" class="small-input" placeholder="Location" style="display:none;">
    <br>
    <label><input type="checkbox" name="catheterTypes" value="Permcath"> Permcath</label>
    <input type="text" name="location_Permcath" class="small-input" placeholder="Location" style="display:none;">
    <br>
    <label><input type="checkbox" name="catheterTypes" value="ICD/PPM"> ICD/PPM</label>
    <input type="text" name="location_ICD_PPM" class="small-input" placeholder="Location" style="display:none;">
    <br>
    <label><input type="checkbox" name="catheterTypes" value="Port-A"> Port-A</label>
    <input type="text" name="location_Port_A" class="small-input" placeholder="Location" style="display:none;">
    <br>
    <label><input type="checkbox" name="catheterTypes" value="Tracheostomy"> Tracheostomy</label>
  </div>

  <label>History of Central vein/SVC stenosisï¼Ÿ</label>
  <select name="svcHistory" required>
    <option value="No">No</option>
    <option value="Yes">Yes</option>
    <option value="Unknown">Unknown</option>
  </select>

  <button type="submit">é€å‡ºè¡¨å–®</button>
</form>

<div id="result" style="display:none;"></div>
<button id="copyButton" style="display:none;">è¤‡è£½å¡«å¯«å…§å®¹</button>
<script>
// å…¨åŸŸè®Šæ•¸
const form = document.getElementById('myForm');
const resultDiv = document.getElementById('result');
const copyButton = document.getElementById('copyButton');
const extraQuestions = document.getElementById('extraQuestions');
const isIsolation = document.getElementById('isIsolation');
const isolationItemDiv = document.getElementById('isolationItemDiv');
const o2Demand = document.getElementById('o2Demand');
const o2ExtraQuestions = document.getElementById('o2ExtraQuestions');
const dnr = document.getElementById('dnr');
const dnrExtraQuestions = document.getElementById('dnrExtraQuestions');
const catheters = document.getElementById('catheters');
const cathetersArea = document.getElementById('cathetersArea');

// æ§åˆ¶Catheterså€åŸŸå‡ºç¾
catheters.addEventListener('change', function() {
  if (this.value === 'Yes') {
    cathetersArea.style.display = 'block';
  } else {
    cathetersArea.style.display = 'none';
    document.querySelectorAll('input[name="catheterTypes"]').forEach(cb => {
      cb.checked = false;
    });
    document.querySelectorAll('input.small-input').forEach(input => {
      input.style.display = 'none';
      input.value = '';
    });
  }
});

// å‹¾é¸Catheteræ™‚é¡¯ç¤ºå°æ‡‰Locationå°æ¡†ï¼ˆTracheostomyç„¡æ¡†ï¼‰
document.querySelectorAll('input[name="catheterTypes"]').forEach((checkbox) => {
  checkbox.addEventListener('change', function() {
    const value = this.value;
    if (value === "Tracheostomy") return; // Tracheostomyä¸éœ€è¦å°æ¡†
    const inputName = 'location_' + value.replace('/', '_').replace('-', '_').replace(' ', '_');
    const locationInput = document.getElementsByName(inputName)[0];
    if (this.checked) {
      locationInput.style.display = 'inline-block';
    } else {
      locationInput.style.display = 'none';
      locationInput.value = '';
    }
  });
});

// ç…§æœƒéœ€æ±‚å‹•æ…‹å­é¡Œç›®
document.getElementById('requestType').addEventListener('change', function() {
  extraQuestions.innerHTML = '';
  if (this.value === 'Permcath/Port-A removal/exchange') {
    extraQuestions.innerHTML = `
      <label>é¸æ“‡é¡å‹ï¼š</label>
      <select name="catheterType" id="catheterType" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="Permcath">Permcath</option>
        <option value="Port-A">Port-A</option>
      </select><br><br>
      <div id="permSubType"></div>
      <label>æ˜¯å¦éœ€è¦ Tip cultureï¼Ÿ</label>
      <select name="tipCulture" required>
        <option value="éœ€Tip culture">éœ€è¦</option>
        <option value="ä¸éœ€Tip culture">ä¸éœ€è¦</option>
      </select><br><br>
    `;
    document.getElementById('catheterType').addEventListener('change', function() {
      const permSubType = document.getElementById('permSubType');
      if (this.value === 'Permcath') {
        permSubType.innerHTML = `
          <label>Permcath Removal or Exchangeï¼Ÿ</label>
          <select name="permAction" required>
            <option value="Removal">Removal</option>
            <option value="Exchange">Exchange</option>
          </select><br><br>
        `;
      } else {
        permSubType.innerHTML = '';
      }
    });
  } else if (this.value === 'PICC insertion') {
    extraQuestions.innerHTML = `
      <label>PICC 1-way æˆ– 2-wayï¼Ÿ</label>
      <select name="piccWay" required>
        <option value="1-way">1-way</option>
        <option value="2-way">2-way</option>
      </select><br><br>
    `;
  } else if (this.value === 'Port-A insertion') {
    extraQuestions.innerHTML = `
      <label>æ˜¯å¦éœ€è¦è§’é‡ï¼Ÿ</label>
      <select name="angleNeedle" required>
        <option value="éœ€è¦è§’é‡">éœ€è¦</option>
        <option value="ä¸éœ€è¦è§’é‡">ä¸éœ€è¦</option>
      </select><br><br>
    `;
  }
});

// O2 Demand é¡å¤–å•é¡Œ
o2Demand.addEventListener('change', function() {
  o2ExtraQuestions.innerHTML = '';
  if (this.value === 'Need O2 supply') {
    o2ExtraQuestions.innerHTML = `
      <label class="sub-item">Deviceï¼š</label>
      <select name="o2Device" required>
        <option value="Mask">Mask</option>
        <option value="NRM">NRM</option>
        <option value="BIPAP">BIPAP</option>
        <option value="HFNC">HFNC</option>
        <option value="Ventilator">Ventilator</option>
        <option value="Collar">Collar</option>
      </select><br><br>
      <label class="sub-item">FiO2 Setting (%)ï¼š</label>
      <input type="text" name="fio2Setting" required><br><br>
      <label class="sub-item">æ˜¯å¦æœ‰Tracheostomyï¼š</label>
      <select name="tracheostomy" required>
        <option value="No">å¦</option>
        <option value="Yes">æ˜¯</option>
      </select><br><br>
    `;
  }
});

// DNR é¡å¤–å•é¡Œ
dnr.addEventListener('change', function() {
  dnrExtraQuestions.innerHTML = '';
  if (this.value === 'Yes') {
    dnrExtraQuestions.innerHTML = `
      <label class="sub-item">ç°½ç½²é …ç›®ï¼ˆå¯å¤šé¸ï¼‰ï¼š</label><br>
      <input type="checkbox" name="dnrItems" value="ä¸é«”å…§å¤–å¿ƒè‡ŸæŒ‰æ‘©">ä¸é«”å…§å¤–å¿ƒè‡ŸæŒ‰æ‘©<br>
      <input type="checkbox" name="dnrItems" value="ä¸å¿ƒè‡Ÿé›»æ“Š">ä¸å¿ƒè‡Ÿé›»æ“Š<br>
      <input type="checkbox" name="dnrItems" value="ä¸é€²è¡Œæ°£ç®¡å…§æ’ç®¡">ä¸é€²è¡Œæ°£ç®¡å…§æ’ç®¡<br>
      <input type="checkbox" name="dnrItems" value="ä¸äººå·¥å‘¼å¸">ä¸äººå·¥å‘¼å¸<br>
      <input type="checkbox" name="dnrItems" value="ä¸äººå·¥èª¿é »">ä¸äººå·¥èª¿é »<br>
      <input type="checkbox" name="dnrItems" value="ä¸æ€¥æ•‘è—¥ç‰©æ³¨å°„">ä¸æ€¥æ•‘è—¥ç‰©æ³¨å°„<br>
      <input type="checkbox" name="dnrItems" value="å…¶ä»–">å…¶ä»–ï¼ˆè«‹å¡«å¯«ï¼‰ï¼š<br>
      <input type="text" name="dnrOther"><br><br>
    `;
  }
});

// æ˜¯å¦éš”é›¢ é¡¯ç¤ºå¡«ç©º
isIsolation.addEventListener('change', function() {
  if (this.value === 'Yes') {
    isolationItemDiv.style.display = 'block';
  } else {
    isolationItemDiv.style.display = 'none';
  }
});
</script>
<script>
// è¡¨å–®é€å‡º
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());

  const dnrItems = [...form.querySelectorAll('input[name="dnrItems"]:checked')].map(x => x.value);
  const catheterCheckboxes = [...form.querySelectorAll('input[name="catheterTypes"]:checked')];
  
  // è‡ªå‹•çµ„åˆç…§æœƒæ¨™é¡Œ
  let title = data.requestType;
  if (data.requestType === 'Permcath/Port-A removal/exchange') {
    if (data.catheterType === 'Permcath') {
      title = `Permcath ${data.permAction}`;
    } else {
      title = `Port-A Removal`;
    }
    if (data.tipCulture) title += ` (${data.tipCulture})`;
  } else if (data.requestType === 'PICC insertion') {
    if (data.piccWay) title = `PICC insertion (${data.piccWay})`;
  } else if (data.requestType === 'Port-A insertion') {
    if (data.angleNeedle) title = `Port-A insertion (${data.angleNeedle})`;
  }

  if (data.hdSchedule) {
    title += `, ${data.hdSchedule}`;
  }
  if (data.isIsolation === 'Yes' && data.isolationItem) {
    title += `, ${data.isolationItem} éš”é›¢`;
  } else {
    title += `, ç„¡éš”é›¢`;
  }

  // ä¸­æ–‡é¡Œç›®å°æ‡‰
  const fieldNames = {
    ageSex: "Age & Sex",
    diseases: "Active problem / Underlying diseases",
    hemodynamic: "Hemodynamic status",
    o2Demand: "O2 Demand",
    consciousness: "Consciousness Status",
    canLieFlat: "èƒ½å¦å¹³èººè‡³å°‘30åˆ†é˜ä¸”é…åˆæŒ‡ä»¤",
    dnr: "æ˜¯å¦ç°½ç½² DNR",
    catheters: "Any catheters/lines implanted at neck/chest",
    svcHistory: "History of Central vein/SVC stenosis",
    isIsolation: "æ˜¯å¦éš”é›¢"
  };

  // çµ„åˆå¡«å¯«å…§å®¹ç¸½çµ
  let resultText = `ğŸ“ è«‹å°‡ä»¥ä¸‹è²¼å…¥ç…§æœƒæ¨™é¡Œï¼š\n${title}\n\nğŸ—’ï¸ è«‹å°‡ä»¥ä¸‹å…§å®¹è²¼å…¥ç…§æœƒå…§å®¹ï¼š\n`;

  const normalOrder = [
    "ageSex", "diseases", "hemodynamic", "o2Demand",
    "consciousness", "canLieFlat", "dnr", "catheters", "svcHistory", "isIsolation"
  ];

  normalOrder.forEach(key => {
    if (data[key]) {
      let mainLine = `- ${fieldNames[key]}ï¼š${data[key]}`;

      if (key === "o2Demand" && data[key] === "Need O2 supply") {
        const subItems = [
          `Device: ${data.o2Device}`,
          `FiO2 Setting: ${data.fio2Setting}`,
          `æ˜¯å¦æœ‰Tracheostomy: ${data.tracheostomy}`
        ];
        mainLine += ` (${subItems.join(', ')})`;
      }

      if (key === "dnr" && data[key] === "Yes") {
        if (dnrItems.length > 0) {
          let dnrList = dnrItems.join(", ");
          if (dnrItems.includes("å…¶ä»–") && data.dnrOther) {
            dnrList = dnrList.replace("å…¶ä»–", `å…¶ä»–: ${data.dnrOther}`);
          }
          mainLine += ` (ç°½ç½²é …ç›®: ${dnrList})`;
        }
      }

      if (key === "catheters" && catheterCheckboxes.length > 0) {
        const catheterDetails = catheterCheckboxes.map(cb => {
          const name = cb.value;
          if (name === "Tracheostomy") return "Tracheostomy"; // ä¸éœ€Location
          const inputName = 'location_' + name.replace('/', '_').replace('-', '_').replace(' ', '_');
          const location = form.querySelector(`input[name="${inputName}"]`)?.value || '';
          return location ? `${name} (${location})` : name;
        });
        mainLine = `- ${fieldNames[key]}ï¼š${catheterDetails.join(", ")}`;
      }

      if (key === "isIsolation" && data[key] === "Yes" && data.isolationItem) {
        mainLine = `- æ˜¯å¦éš”é›¢ï¼šYesï¼ˆ${data.isolationItem}ï¼‰`;
      } else if (key === "isIsolation" && data[key] === "No") {
        mainLine = `- æ˜¯å¦éš”é›¢ï¼šNo`;
      }

      resultText += mainLine + "\n";
    }
  });

  resultDiv.textContent = resultText;
  resultDiv.style.display = 'block';
  copyButton.style.display = 'inline-block';
  form.reset();
  cathetersArea.style.display = 'none';
});

// ä¸€éµè¤‡è£½åŠŸèƒ½
copyButton.addEventListener('click', () => {
  navigator.clipboard.writeText(resultDiv.textContent)
    .then(() => { alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼'); })
    .catch(err => { alert('è¤‡è£½å¤±æ•—ï¼š' + err); });
});
</script>

</body>
</html>

